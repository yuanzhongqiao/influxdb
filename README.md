<div class="Box-sc-g0xbh4-0 bJMeLZ js-snippet-clipboard-copy-unpositioned" data-hpc="true"><article class="markdown-body entry-content container-lg" itemprop="text"><div class="markdown-heading" dir="auto"><h1 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB边缘</font></font></h1><a id="user-content-influxdb-edge" class="anchor" aria-label="永久链接：InfluxDB Edge" href="#influxdb-edge"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<div class="markdown-alert markdown-alert-note" dir="auto"><p class="markdown-alert-title" dir="auto"><svg class="octicon octicon-info mr-2" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="M0 8a8 8 0 1 1 16 0A8 8 0 0 1 0 8Zm8-6.5a6.5 6.5 0 1 0 0 13 6.5 6.5 0 0 0 0-13ZM6.5 7.75A.75.75 0 0 1 7.25 7h1a.75.75 0 0 1 .75.75v2.75h.25a.75.75 0 0 1 0 1.5h-2a.75.75 0 0 1 0-1.5h.25v-2h-.25a.75.75 0 0 1-.75-.75ZM8 6a1 1 0 1 1 0-2 1 1 0 0 1 0 2Z"></path></svg><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">笔记</font></font></p><p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">2023 年 9 月 21 日，该存储库将默认分支从 master 更改为 main。同时，我们将所有 InfluxDB 2.x 开发移至 main-2.x 分支。如果您依赖于以前的 master 分支中的 2.x 代码库，请更新您的工具以指向 main-2.x，这是任何未来 InfluxDB 2.x 开发的新家。该分支（主分支）现在是该存储库的默认分支，用于开发 InfluxDB 3.x。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前，这意味着 InfluxDB 3.0 及其上游依赖项是我们开源工作的重点。我们继续为客户支持 InfluxDB 的 1.x 和 2.x 版本，但我们新的开发工作现在集中在 3.x 上。本自述文件的其余部分提供了有关 3.0 以及您可以期待的更多详细信息。</font></font></p>
</div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB 是一个用 Rust 编写的开源时间序列数据库，使用 Apache Arrow、Apache Parquet 和 Apache DataFusion 作为其基础构建块。 InfluxDB 的最新版本 (3.x) 专注于为各种观察数据（指标、事件、日志、跟踪等）提供实时缓冲区，这些数据可通过 SQL 或 InfluxQL 查询，并批量保存到对象存储为 Parquet 文件，供其他第三方系统使用。如果禁用了预写日志，它可以使用预写日志运行，也可以完全脱离对象存储运行（在这种操作模式下，对于尚未持久保存到对象存储的任何缓冲数据，存在潜在的数据丢失窗口） ）。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">该开源项目作为独立系统在单个进程中运行。如果您正在寻找具有大量企业安全功能的集群式分布式时间序列数据库，我们可以提供商业产品，作为托管服务或设计为在 Kubernetes 内运行的本地软件。分布式版本还包括重新组织对象存储中的文件以获得最佳查询性能的功能。未来，我们打算推出单一服务器软件的商业版本，增加细粒度的安全性、联合查询功能、用于查询优化和删除的文件重组以及与其他系统的集成。</font></font></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">项目状况</font></font></h2><a id="user-content-project-status" class="anchor" aria-label="永久链接：项目状态" href="#project-status"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">目前该项目正在进行原型开发，没有文档或官方版本。此自述文件将在时机成熟时更新入门详细信息和文档链接。</font></font></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">路线图</font></font></h2><a id="user-content-roadmap" class="anchor" aria-label="永久链接：路线图" href="#roadmap"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这个开源 InfluxDB 3.0 的范围不同于 InfluxDB 1.x 或 2.x。这可能会随着时间的推移而改变，但目前我们计划的基本内容如下：</font></font></p>
<ul dir="auto">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB 1.x 和 2.x HTTP 写入 API（支持 Line 协议）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB 1.x HTTP 查询 API (InfluxQL)</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flight SQL（使用 SQL 的查询 API）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxQL 飞行</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">适用于 InfluxDB 1.x 和 2.x 到 3.0 的数据迁移工具</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB 3.0 HTTP 写入 API（一种使用比 1.x 或 2.x 更具表现力的数据模型写入数据的新方法）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">InfluxDB 3.0 HTTP 查询 API（将 InfluxQL 或 SQL 查询作为 HTTP GET 发送并获取 JSON 行、CSV 或漂亮的打印响应）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持久事件流（订阅 Parquet 文件持久事件，对于下游客户端从对象存储中获取文件很有用）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">嵌入式 VM（Python、Javascript、WASM 或其某种组合）
</font></font><ul dir="auto">
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">个别查询</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">写入时触发</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">持久化（运行通过脚本持久化的任何内容）</font></font></li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">按照时间表</font></font></li>
</ul>
</li>
<li><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">不记名令牌身份验证（全有或全无，令牌在启动时通过环境变量设置，更细粒度的安全性超出了开源工作的范围）</font></font></li>
</ul>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这意味着 InfluxDB 3.0 可以被视为具有大部分功能的 InfluxDB 1.x 服务器。对于主要通过 InfluxQL 查询功能与数据库进行交互的 InfluxDB 2.x 用户，他们也将能够以类似的方式使用该数据库。 3.0 版本不会原生实现 2.x API 的其余部分，尽管可能会在以后添加一些单独的进程来提供该功能。</font></font></p>
<div class="markdown-heading" dir="auto"><h2 tabindex="-1" class="heading-element" dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">通量</font></font></h2><a id="user-content-flux" class="anchor" aria-label="永久链接： 通量" href="#flux"><svg class="octicon octicon-link" viewBox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path d="m7.775 3.275 1.25-1.25a3.5 3.5 0 1 1 4.95 4.95l-2.5 2.5a3.5 3.5 0 0 1-4.95 0 .751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018 1.998 1.998 0 0 0 2.83 0l2.5-2.5a2.002 2.002 0 0 0-2.83-2.83l-1.25 1.25a.751.751 0 0 1-1.042-.018.751.751 0 0 1-.018-1.042Zm-4.69 9.64a1.998 1.998 0 0 0 2.83 0l1.25-1.25a.751.751 0 0 1 1.042.018.751.751 0 0 1 .018 1.042l-1.25 1.25a3.5 3.5 0 1 1-4.95-4.95l2.5-2.5a3.5 3.5 0 0 1 4.95 0 .751.751 0 0 1-.018 1.042.751.751 0 0 1-1.042.018 1.998 1.998 0 0 0-2.83 0l-2.5 2.5a1.998 1.998 0 0 0 0 2.83Z"></path></svg></a></div>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">Flux 是我们开发的自定义脚本和查询语言，作为 InfluxDB 2.0 工作的一部分。虽然我们将继续为客户支持 Flux，但 InfluxDB 3.0 的描述中明显没有它。我们用 Go 编写了 Flux，希望它能得到广泛采用，并使用户能够使用数据库做以前不可能完成的事情。虽然我们提供了一种强大的新方法来处理时间序列数据，但许多用户发现 Flux 是数据库采用的障碍。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">从 2018 年开始，我们和一个小开发团队在 Flux 上花费了多年的开发人员的努力。然而，工作量巨大，包括创建新语言、虚拟机、查询规划器、解析器、优化器和执行引擎。我们最终无法将我们所希望的注意力集中在更多的语言功能、工具以及整体可用性和开发人员体验上。我们不断致力于提高性能，但因为我们是从头开始构建一切，所以所有的努力都完全落在我们小团队的肩上。我们认为这最终使我们无法进行可用性改进，而这些改进本来可以帮助 Flux 获得更广泛的采用。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">对于 InfluxDB 3.0，我们采用 Apache Arrow DataFusion、现有的查询解析器、规划器和执行器作为我们的核心引擎。那是在 2020 年中期，在过去三年中，活跃且不断发展的社区做出了重大贡献。虽然我们仍然是该项目的主要贡献者，但它不断从全球开发人员那里获得功能增强和性能改进。我们在 Flux 实现上的努力根本无法跟上更大的 DataFusion 开发人员群体的步伐。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">由于 InfluxDB 3.0 使用新语言（从 Go 到 Rust）对数据库进行了彻底重写，我们无法引入 Flux 实现。对于 InfluxQL，我们能够通过用 Rust 编写语言解析器来原生支持它，然后将 InfluxQL 查询转换为我们新的本机查询引擎 Apache Arrow DataFusion 可以理解和处理的逻辑计划。我们还必须向查询引擎添加新功能，以支持 InfluxQL 支持的一些时间序列查询。这项工作花费了一年多的时间，并且仍在继续。这种方法意味着对 DataFusion 的贡献也成为对 InfluxQL 的改进，因为它是底层引擎。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">最初，我们在 3.0 中支持 Flux 的计划是通过数据库提供的较低级别的 API 来实现。在我们的 Cloud2 产品中，Flux 进程通过 gRPC API 连接到 InfluxDB 1 和 2 TSM 存储引擎。我们在 InfluxDB 3.0 中构建了对此的支持，并开始使用镜像生产工作负载进行测试。我们很快发现这个界面表现不佳，并且存在不可预见的错误，因此将其作为 Flux 用户将脚本升级到 3.0 的可行选项而予以消除。这是因为 API 是围绕 TSM 存储引擎的非常特定的格式设计的，而 3.0 引擎无法快速提供这种格式。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将继续为我们的用户和客户支持 Flux。但考虑到 Flux 除了是一种查询语言、规划器、优化器和执行引擎之外，还是一种脚本语言，它的 Rust 原生版本可能遥不可及。而且由于该语言的表面积如此之大，因此这样的努力不太可能产生一个足够兼容的版本，无需修改或重写即可运行现有的 Flux 查询，这将消除一开始的努力点。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">为了让 Flux 有前进的道路，我们认为最好的计划是更新核心引擎，以便它可以使用 Flight SQL 与 InfluxDB 3.0 对话。这将形成一个架构，其中服务于 InfluxDB 2.x 查询 API（即 Flux）的独立进程将能够将 Flux 脚本的查询部分转换为 SQL 查询，然后将其发送到 InfluxDB 3.0 进程结果由 Flux 引擎进行后处理。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">这可能不是一个小工作，因为 Flux 引擎是围绕 InfluxDB 2.0 的 TSM 存储引擎构建的，并将所有数据表示为单独的时间序列。 InfluxDB 3.0 不保留系列的概念，因此 SQL 查询要么必须执行大量工作才能返回单个系列，要么 Flux 引擎将使用生成的查询响应来构建系列。目前，我们专注于改进核心 SQL 和（以及扩展的 InfluxQL）查询引擎以及 InfluxDB 3.0 和 DataFusion 中的体验。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们将来可能会再次致力于这项工作，但我们不想阻止社区自行组织推动 Flux 向前发展的努力。 Flux 运行时和语言</font></font><a href="https://github.com/InfluxCommunity/flux"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">在这里</font></font></a><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">作为许可的开源代码存在。我们还创建了一个 Flux 社区分支，社区可以在其中自我组织并推动开发，而不需要我们的代码审查过程。已经有一些社区成员致力于这条潜在的前进道路。如果您有兴趣帮助完成这项工作，请就这个跟踪的问题发表意见。</font></font></p>
<p dir="auto"><font style="vertical-align: inherit;"><font style="vertical-align: inherit;">我们意识到 Flux 仍然拥有热情的用户群（尽管规模很小），我们希望为这些用户找出最佳的前进道路。目前，由于我们的资源有限，我们认为将精力集中在改进 Apache Arrow DataFusion 和 InfluxDB 3.0 对它的使用上，是为愿意转换为 InfluxQL 或 SQL 的用户提供服务的最佳方式。与此同时，我们将继续为我们的用户和客户维护 Flux 的安全性和关键修复。</font></font></p>
</article></div>
